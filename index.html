<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Starry.IO - Click Game</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <!-- Add the bad-words library from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/bad-words"></script>
</head>
<body>
    <!-- Background Music (Hidden) -->
    <audio id="bgMusic" loop>
        <source src="music.mp3" type="audio/mp3">
    </audio>

    <!-- Click Sound Effect (Hidden) -->
    <audio id="clickSound">
        <source src="click.mp3" type="audio/mp3">
    </audio>

    <!-- Music Toggle Button -->
    <button id="musicToggle">ðŸŽµ Toggle Music</button>

    <!-- Warning message when game is updating -->
    <div id="updateMessage" class="update-warning hidden">
        <p>Game will update soon. Please bear with us!</p>
        <button id="closeUpdateMessage">Close</button>
    </div>

    <header>
        <h1>Starry.IO</h1>
    </header>

    <div class="stars"></div>

    <div id="gameContainer">
        <div class="content">
            <button id="clickButton">Click Me!</button>
            <p>Score: <span id="score">0</span></p>
            <button id="loginToggle">Login / Sign Up</button>
            <button id="logoutBtn" class="hidden">Logout</button>
        </div>
    </div>

    <div id="authContainer" class="hidden">
        <h2>Login / Sign Up</h2>
        <input type="text" id="username" placeholder="Username">
        <input type="password" id="password" placeholder="Password">
        <button id="loginBtn">Login</button>
        <button id="signupBtn">Sign Up</button>
        <p id="authMessage"></p>
        <button id="closeAuth">Close</button>
    </div>

    <!-- Chat System -->
    <div id="chatContainer">
        <h2>Chat</h2>
        <div id="chat-box" style="height: 300px; overflow-y: scroll; border: 1px solid black; margin-bottom: 10px;"></div>
        <input type="text" id="chat-input" placeholder="Type your message here..." />
        <button id="sendMessageBtn">Send</button>
    </div>

    <script>
        // Set the current version of the game
        const currentVersion = '1.1.0';  // Change this version when you release an update

        // Check if the version has changed
        const savedVersion = localStorage.getItem('gameVersion');

        // If the version is different, show the update message
        if (savedVersion !== currentVersion) {
            // Display a warning that the game will update soon
            document.getElementById('updateMessage').style.display = 'block';
            
            // Update the stored version to the new one
            localStorage.setItem('gameVersion', currentVersion);
        }

        // Event listener to hide the message
        document.getElementById('closeUpdateMessage').addEventListener('click', function() {
            document.getElementById('updateMessage').style.display = 'none';
        });

        // Game logic
        let score = localStorage.getItem('score') ? parseInt(localStorage.getItem('score')) : 0;  // Load score from localStorage
        const scoreDisplay = document.getElementById('score');
        const clickButton = document.getElementById('clickButton');

        // Function to update the score display
        function updateScoreDisplay() {
            scoreDisplay.textContent = score;
        }

        // Function to save the score to localStorage
        function saveScore() {
            localStorage.setItem('score', score);
        }

        // Handle "Click Me!" button click to increment score
        clickButton.addEventListener('click', () => {
            score++;
            updateScoreDisplay();
            saveScore();
        });

        // Chat System with Profanity Filter
        const filter = new BadWords();  // Initialize the profanity filter

        // Function to send and display chat messages
        function sendChatMessage() {
            const message = document.getElementById('chat-input').value;
            if (message.trim()) {
                // Clean the message using the profanity filter
                const cleanMessage = filter.clean(message);

                // Display the cleaned message in the chat box
                const chatBox = document.getElementById('chat-box');
                chatBox.innerHTML += `<p>${cleanMessage}</p>`;
                chatBox.scrollTop = chatBox.scrollHeight;  // Auto-scroll to the bottom

                // Clear the input field
                document.getElementById('chat-input').value = '';
            }
        }

        // Listen for the send message button click
        document.getElementById('sendMessageBtn').addEventListener('click', sendChatMessage);

        // Login system
        const loginToggle = document.getElementById('loginToggle');
        const logoutBtn = document.getElementById('logoutBtn');
        const authContainer = document.getElementById('authContainer');
        const closeAuth = document.getElementById('closeAuth');
        const loginBtn = document.getElementById('loginBtn');
        const signupBtn = document.getElementById('signupBtn');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const authMessage = document.getElementById('authMessage');

        // Check if user is logged in
        const currentUser = localStorage.getItem('username');
        if (currentUser) {
            loginToggle.textContent = `Welcome, ${currentUser}`;
            logoutBtn.classList.remove('hidden');
        } else {
            loginToggle.textContent = 'Login / Sign Up';
            logoutBtn.classList.add('hidden');
        }

        // Toggle Login / Sign Up form
        loginToggle.addEventListener('click', () => {
            authContainer.classList.toggle('hidden');
        });

        // Close the login/signup form
        closeAuth.addEventListener('click', () => {
            authContainer.classList.add('hidden');
        });

        // Login function
        loginBtn.addEventListener('click', () => {
            const username = usernameInput.value;
            const password = passwordInput.value;

            // Simple login validation (for demonstration)
            const storedPassword = localStorage.getItem(username);
            if (storedPassword === password) {
                localStorage.setItem('username', username);
                loginToggle.textContent = `Welcome, ${username}`;
                authContainer.classList.add('hidden');
                logoutBtn.classList.remove('hidden');
                authMessage.textContent = 'Logged in successfully!';
            } else {
                authMessage.textContent = 'Invalid username or password.';
            }
        });

        // Sign Up function
        signupBtn.addEventListener('click', () => {
            const username = usernameInput.value;
            const password = passwordInput.value;

            if (localStorage.getItem(username)) {
                authMessage.textContent = 'Username already exists.';
            } else {
                localStorage.setItem(username, password);
                authMessage.textContent = 'Account created successfully!';
            }
        });
    </script>
</body>
</html>
